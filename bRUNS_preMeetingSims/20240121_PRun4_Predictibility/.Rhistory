source("C:/Users/laksh/Downloads/OGH_Eusociality/bRUNS_postRuns/20240117_PRun2_LargeVaryingUnitTimes_D2v2/confirm_presence.R")
source("C:/Users/laksh/Downloads/OGH_Eusociality/bRUNS_postRuns/20240117_PRun2_LargeVaryingUnitTimes_D2v2/analysis_combined.R")
warning()
condition <- conditions_to_compare[1]
# Create an empty list to store plots
plots_react <- list()
# Number of replicates
num_replicates <- 3  # Change this number based on your requirement
for (condition in conditions_to_compare) {
# Subset the combined_data for the specific condition
if (condition %in% unique(mapping$condition)) {
valid_conditions <- c(valid_conditions, condition)
subset_data <- all_individuals[all_individuals$cond == condition, ]
for (replic in unique(subset_data$rep)) {
print(paste(condition, " : ", replic))
folder <- mapping$X[mapping$condition == condition & mapping$rp == replic]
basis_pattern <- "_basis.csv"
basis_files <- list.files(path = paste0("./", folder), pattern = basis_pattern, full.names = TRUE)
# Check if files are found
if (length(basis_files) > 0) {
# Read the first file (assuming only one file matches the pattern)
basis <- data.frame(read.csv(basis_files[1], header = FALSE))
basis <- basis[,-6]
}
rep_subset <- subset_data[subset_data$rep == replic, ]
betas <- rep_subset %>% dplyr::select(beta0, beta1, beta2, beta3, beta4) # select gene values 1-5, which are the gene values for the larval reaction norm
time <- Sys.time() # record system time
set.seed(time) # use time to seed the rng
number_larvae <- length(unique(rep_subset$ind_id))
if (number_larvae > 100) {
number_larvae <- 100
}
number_larvae <- 25
subset_betas <- betas[sample(nrow(betas), number_larvae, replace = FALSE), ] # sample random 100 larvae
mat_results <- matrix(NA, ncol = 2, nrow = nrow(basis) * number_larvae)
# number_larvae <- 10
# evaluate spline
upper_loop_limit <- nrow(basis) * number_larvae
for (i in c(1:upper_loop_limit)) {
# multiply each of the rows of the basis matrix with the betas (gene values) as a column vector
# this occurs first by the 100 different nutrition levels that have been precalculated
# and then by the different larvae
mat_results[i,1] <- as.matrix(basis[i - ((i - 1) %/% nrow(basis) * nrow(basis)), ]) %*% t(as.matrix(subset_betas[(i - 1 + nrow(basis)) %/% nrow(basis), ]))
# record an id for the larvae
mat_results[i,2] <- (i - 1 + nrow(basis)) %/% nrow(basis)
}
larval_level <- rep(basis$V2, number_larvae) # predetermined steps of x (nutrition level) to the data frame. this can be read from X0 of the basis matrix
data_plotting <- cbind(larval_level, mat_results) # combine these nutrition levels with the spline evaluation
data_plotting <- as.data.frame(data_plotting) # make a data frame
data_plotting$logistic_vals <- 1/(1+exp(data_plotting$V2))
color_value <- colors_vector[replic]
data_plotting$V3 <- as.factor(data_plotting$V3)
data_plotting$larval_level <- data_plotting$larval_level*500.0
p <- ggplot(data_plotting, aes(x=larval_level, y=logistic_vals, group=V3)) +
stat_summary(aes(x=larval_level, y=logistic_vals, group=V3), fun=mean, geom="line", linewidth=1.5, alpha=0.8, col = "grey") +
scale_y_continuous(name="Foraging probability", limits = c(0.0, 1.0), breaks = seq(0.0, 1.0, 0.2)) +
scale_x_continuous(name="Larval levels", limits = c(0.0, 500.0), breaks = seq(0.0,500.0,50.0)) +
theme_minimal() +
theme(
axis.text = element_text(size=11,face="plain",color="black"),
axis.title = element_text(size = 13),
axis.line = element_line(color="black", linewidth = 0.6),
panel.border = element_rect(colour = "darkgray", fill=NA, linetype=0.5)
) +
labs(title = paste0(condition, " : ", replic))
# Add the plot to the list for replicates
plots_replicates[[as.character(replic)]] <- p
}
# Add the list of plots for replicates to the overall list
plots_react[[condition]] <- plots_replicates
}
}
condition
rep
valid_conditions <- c(valid_conditions, condition)
subset_data <- all_individuals[all_individuals$cond == condition, ]
combined_data <- data.frame()
for (dum in seq(1:dim(mapping)[1])) {
folder <- mapping$X[dum]
condition <- mapping$condition[mapping$X == folder]
# Check if condition is not NA
if (mapping$lou[dum] && (condition %in% conditions_to_compare)) {
# Generate file name pattern
file_pattern <- "_LastOfUs.csv"
# List files in the folder
files <- list.files(path = paste0("./", folder), pattern = file_pattern, full.names = TRUE)
# Check if files are found
if (length(files) > 0) {
# Read the first file (assuming only one file matches the pattern)
data <- read.csv(files[1])
data$rep <- mapping$rp[mapping$X == folder]
data$cond <- condition
# Combine with previous data or create a new dataset
if (exists("combined_data")) {
combined_data <- rbind(combined_data, data)
} else {
combined_data <- data
}
}
}
}
source("C:/Users/laksh/Downloads/OGH_Eusociality/bRUNS_postRuns/20240117_PRun2_LargeVaryingUnitTimes_D2v2/confirm_presence.R")
dum
dum = 4
# Generate file name pattern
file_pattern <- "_LastOfUs.csv"
folder <- mapping$X[dum]
condition <- mapping$condition[mapping$X == folder]
# Generate file name pattern
file_pattern <- "_LastOfUs.csv"
# List files in the folder
files <- list.files(path = paste0("./", folder), pattern = file_pattern, full.names = TRUE)
# Check if files are found
if (length(files) > 0) {
# Read the first file (assuming only one file matches the pattern)
data <- read.csv(files[1])
data$rep <- mapping$rp[mapping$X == folder]
data$cond <- condition
# Combine with previous data or create a new dataset
if (exists("combined_data")) {
combined_data <- rbind(combined_data, data)
} else {
combined_data <- data
}
}
dum
combined_data <- data.frame()
combined_data <- data
#### Last of US data graphs ####
combined_data <- data.frame()
for (dum in seq(1:dim(mapping)[1])) {
folder <- mapping$X[dum]
condition <- mapping$condition[mapping$X == folder]
# Check if condition is not NA
if (mapping$lou[dum] && (condition %in% conditions_to_compare)) {
# Generate file name pattern
file_pattern <- "_LastOfUs.csv"
# List files in the folder
files <- list.files(path = paste0("./", folder), pattern = file_pattern, full.names = TRUE)
# Check if files are found
if (length(files) > 0) {
# Read the first file (assuming only one file matches the pattern)
data <- read.csv(files[1])
data$rep <- mapping$rp[mapping$X == folder]
data$cond <- condition
# Combine with previous data or create a new dataset
if (exists("combined_data")) {
combined_data <- rbind(combined_data, data)
} else {
combined_data <- data
}
}
}
}
# Subset dead individuals (t_death != -1)
dead_individuals <- combined_data[combined_data$t_death != -1, ]
alive_individuals <- combined_data[combined_data$t_death == -1, ]
# Subset alive individuals (keep the row with the largest gtime)
alive_individuals <- alive_individuals[!duplicated(alive_individuals$ind_id, fromLast = TRUE), ]
alive_individuals <- alive_individuals[!(alive_individuals$ind_id %in% unique(dead_individuals$ind_id)), ]
# Combine the subsets if needed
all_individuals <- rbind(dead_individuals, alive_individuals)
valid_conditions <- c()
num_nests_lou <- 25
# Create a list to store plots for each condition
plots_reactionNorms <- list()
# Loop through each condition
# Loop through each condition
valid_conditions <- c()
dum_color <- c("blue", "red", "green")
colors_vector <- c("#FF0000", "#0000FF", "#00FF00", "#000000", "#FFC0CB")
# Create a vector of unique colors for replicates
# replicate_colors <- viridis::viridis_pal()(length(unique(subset_data$rep)))
subset_data <- data.frame()
##### Reaction norms #####
# Create an empty list to store plots
plots_react <- list()
# Number of replicates
num_replicates <- 3  # Change this number based on your requirement
for (condition in conditions_to_compare) {
# Subset the combined_data for the specific condition
if (condition %in% unique(mapping$condition)) {
valid_conditions <- c(valid_conditions, condition)
subset_data <- all_individuals[all_individuals$cond == condition, ]
for (replic in unique(subset_data$rep)) {
print(paste(condition, " : ", replic))
folder <- mapping$X[mapping$condition == condition & mapping$rp == replic]
basis_pattern <- "_basis.csv"
basis_files <- list.files(path = paste0("./", folder), pattern = basis_pattern, full.names = TRUE)
# Check if files are found
if (length(basis_files) > 0) {
# Read the first file (assuming only one file matches the pattern)
basis <- data.frame(read.csv(basis_files[1], header = FALSE))
basis <- basis[,-6]
}
rep_subset <- subset_data[subset_data$rep == replic, ]
betas <- rep_subset %>% dplyr::select(beta0, beta1, beta2, beta3, beta4) # select gene values 1-5, which are the gene values for the larval reaction norm
time <- Sys.time() # record system time
set.seed(time) # use time to seed the rng
number_larvae <- length(unique(rep_subset$ind_id))
if (number_larvae > 100) {
number_larvae <- 100
}
#number_larvae <- 25
subset_betas <- betas[sample(nrow(betas), number_larvae, replace = FALSE), ] # sample random 100 larvae
mat_results <- matrix(NA, ncol = 2, nrow = nrow(basis) * number_larvae)
# number_larvae <- 10
# evaluate spline
upper_loop_limit <- nrow(basis) * number_larvae
for (i in c(1:upper_loop_limit)) {
# multiply each of the rows of the basis matrix with the betas (gene values) as a column vector
# this occurs first by the 100 different nutrition levels that have been precalculated
# and then by the different larvae
mat_results[i,1] <- as.matrix(basis[i - ((i - 1) %/% nrow(basis) * nrow(basis)), ]) %*% t(as.matrix(subset_betas[(i - 1 + nrow(basis)) %/% nrow(basis), ]))
# record an id for the larvae
mat_results[i,2] <- (i - 1 + nrow(basis)) %/% nrow(basis)
}
larval_level <- rep(basis$V2, number_larvae) # predetermined steps of x (nutrition level) to the data frame. this can be read from X0 of the basis matrix
data_plotting <- cbind(larval_level, mat_results) # combine these nutrition levels with the spline evaluation
data_plotting <- as.data.frame(data_plotting) # make a data frame
data_plotting$logistic_vals <- 1/(1+exp(data_plotting$V2))
color_value <- colors_vector[replic]
data_plotting$V3 <- as.factor(data_plotting$V3)
data_plotting$larval_level <- data_plotting$larval_level*500.0
p <- ggplot(data_plotting, aes(x=larval_level, y=logistic_vals, group=V3)) +
stat_summary(aes(x=larval_level, y=logistic_vals, group=V3), fun=mean, geom="line", linewidth=1.5, alpha=0.8, col = "grey") +
scale_y_continuous(name="Foraging probability", limits = c(0.0, 1.0), breaks = seq(0.0, 1.0, 0.2)) +
scale_x_continuous(name="Larval levels", limits = c(0.0, 500.0), breaks = seq(0.0,500.0,50.0)) +
theme_minimal() +
theme(
axis.text = element_text(size=11,face="plain",color="black"),
axis.title = element_text(size = 13),
axis.line = element_line(color="black", linewidth = 0.6),
panel.border = element_rect(colour = "darkgray", fill=NA, linetype=0.5)
) +
labs(title = paste0(condition, " : ", replic))
# Add the plot to the list for replicates
plots_replicates[[as.character(replic)]] <- p
}
# Add the list of plots for replicates to the overall list
plots_react[[condition]] <- plots_replicates
}
}
combined_data <- data.frame()
for (dum in seq(1:dim(mapping)[1])) {
folder <- mapping$X[dum]
condition <- mapping$condition[mapping$X == folder]
# Check if condition is not NA
if (mapping$lou[dum] && (condition %in% conditions_to_compare)) {
# Generate file name pattern
print("Haloooo")
print(dum)
file_pattern <- "_LastOfUs.csv"
# List files in the folder
files <- list.files(path = paste0("./", folder), pattern = file_pattern, full.names = TRUE)
# Check if files are found
if (length(files) > 0) {
# Read the first file (assuming only one file matches the pattern)
data <- read.csv(files[1])
data$rep <- mapping$rp[mapping$X == folder]
data$cond <- condition
print(dim(data))
# Combine with previous data or create a new dataset
if (exists("combined_data")) {
combined_data <- rbind(combined_data, data)
} else {
combined_data <- data
}
}
}
}
# Subset dead individuals (t_death != -1)
dead_individuals <- combined_data[combined_data$t_death != -1, ]
alive_individuals <- combined_data[combined_data$t_death == -1, ]
# Subset alive individuals (keep the row with the largest gtime)
alive_individuals <- alive_individuals[!duplicated(alive_individuals$ind_id, fromLast = TRUE), ]
alive_individuals <- alive_individuals[!(alive_individuals$ind_id %in% unique(dead_individuals$ind_id)), ]
# Combine the subsets if needed
all_individuals <- rbind(dead_individuals, alive_individuals)
valid_conditions <- c()
combined_data <- data.frame()
for (dum in seq(1:dim(mapping)[1])) {
folder <- mapping$X[dum]
condition <- mapping$condition[mapping$X == folder]
print(dum)
# Check if condition is not NA
if (mapping$lou[dum] && (condition %in% conditions_to_compare)) {
# Generate file name pattern
print("Haloooo")
print(dum)
file_pattern <- "_LastOfUs.csv"
# List files in the folder
files <- list.files(path = paste0("./", folder), pattern = file_pattern, full.names = TRUE)
# Check if files are found
if (length(files) > 0) {
# Read the first file (assuming only one file matches the pattern)
data <- read.csv(files[1])
data$rep <- mapping$rp[mapping$X == folder]
data$cond <- condition
print(dim(data))
# Combine with previous data or create a new dataset
if (exists("combined_data")) {
combined_data <- rbind(combined_data, data)
} else {
combined_data <- data
}
}
}
}
View(mapping)
#### Last of US data graphs ####
combined_data <- data.frame()
for (dum in seq(1:dim(mapping)[1])) {
folder <- mapping$X[dum]
condition <- mapping$condition[mapping$X == folder]
print(dum)
# Check if condition is not NA
if (mapping$lou[dum] & (condition %in% conditions_to_compare)) {
# Generate file name pattern
print("Haloooo")
print(dum)
file_pattern <- "_LastOfUs.csv"
# List files in the folder
files <- list.files(path = paste0("./", folder), pattern = file_pattern, full.names = TRUE)
# Check if files are found
if (length(files) > 0) {
# Read the first file (assuming only one file matches the pattern)
data <- read.csv(files[1])
data$rep <- mapping$rp[mapping$X == folder]
data$cond <- condition
print(dim(data))
# Combine with previous data or create a new dataset
if (exists("combined_data")) {
combined_data <- rbind(combined_data, data)
} else {
combined_data <- data
}
}
}
}
mapping$lou[dum] & (condition %in% conditions_to_compare)
dum <- 4
bigBosstitle <- "D2midFor"
# Step 1: Classifying data
mapping <- read.csv("mapping_condition.csv")
conditions_to_compare <- c("lowBrood_midFor", "midBrood_midFor", "highBrood_midFor")  # Add the conditions you want to compare
#### Last of US data graphs ####
combined_data <- data.frame()
for (dum in seq(1:dim(mapping)[1])) {
folder <- mapping$X[dum]
condition <- mapping$condition[mapping$X == folder]
print(dum)
# Check if condition is not NA
if (mapping$lou[dum] && (condition %in% conditions_to_compare)) {
# Generate file name pattern
print("Haloooo")
print(dum)
file_pattern <- "_LastOfUs.csv"
# List files in the folder
files <- list.files(path = paste0("./", folder), pattern = file_pattern, full.names = TRUE)
# Check if files are found
if (length(files) > 0) {
# Read the first file (assuming only one file matches the pattern)
data <- read.csv(files[1])
data$rep <- mapping$rp[mapping$X == folder]
data$cond <- condition
print(dim(data))
# Combine with previous data or create a new dataset
if (exists("combined_data")) {
combined_data <- rbind(combined_data, data)
} else {
combined_data <- data
}
}
}
}
dum = 4
folder <- mapping$X[dum]
condition <- mapping$condition[mapping$X == folder]
mapping$lou[dum] && (condition %in% conditions_to_compare)
conditions_to_compare
condition
condition %in% conditions_to_compare
mapping$lou[dum]
dForagingMean <- seq(0.5,1.5,0.5)
dForagingSD <- seq(0.1,0.5,0.2)
